<ccms-filter
  [label]="label()"
  [expandable]="true"
  [removable]="removable()"
  (removed)="removed.emit()"
  [ccmsPopupMenuTrigger]="menu"
>
  <span class="filter-value">{{ displayValue() }}</span>

  <ccms-popup-menu
    #menu
    [multiSelect]="selectionMode() === 'multi'"
    [selectedValues]="selectedValues()"
    (selectionChange)="onSelectionChange($event)"
  >
    @if (showSearch()) {
      <div class="filter-menu-search">
        <input
          type="text"
          class="filter-menu-search__input"
          placeholder="Search..."
          (input)="onSearch($event)"
        />
      </div>
    }

    @if (selectionMode() === 'multi') {
      <ccms-popup-menu-item [selectAll]="true" (selected)="onSelectAll($event)"
        >All</ccms-popup-menu-item
      >
    }

    @if (hasOptionsError()) {
      <ccms-popup-menu-item [disabled]="true" class="filter-menu-error"
        >Failed to load options</ccms-popup-menu-item
      >
    } @else if (optionsSignal().length > 0) {
      @for (option of filterOptions(optionsSignal()); track option.value) {
        <ccms-popup-menu-item [value]="option.value">
          {{ option.label }}
        </ccms-popup-menu-item>
      }
    } @else {
      <ccms-popup-menu-item [disabled]="true">Loading...</ccms-popup-menu-item>
    }
  </ccms-popup-menu>
</ccms-filter>
